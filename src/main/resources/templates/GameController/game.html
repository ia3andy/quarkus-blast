{#include layout/page.html}
{#fragment id=content}
{#if game}
<div class="container text-center game-container d-flex flex-grow-1 flex-column">
  <div class="container flex-grow-1 justify-content-center d-flex flex-column order-lg-1">
    {#if game.completed}
    <div class="alert alert-success d-flex align-items-center mt-5 mb-2" role="alert" _="on load call playSound('blasted', 100)">
      <i class="blast-score bi flex-shrink-0 me-2"></i>
      <div>
        Congratulation, you blasted it all, your subatomic score is: <b>{game.score}</b>
      </div>
    </div>
    {#include GameController/saveScore.html}{/include}
    {#else}

    <div class="game-grid container text-center">
      {#for row in game.grid()}
      <div class="row">
        {#for col in row}
        {#if !col.blasted}
        <div class="col cell {col.type}"
          hx-post="{uri:GameController.play(game.id, col.row, col.column)}"
          hx-target="#content"
        >
          {col.charge}
        </div>
        {#else if col.charge > 0}
        <div class="col cell blasted" _="on load blast(me, '{col.type}', {col.charge}/1000)"></div>
        {#else}
        <div class="col cell blasted"></div>
        {/if}
        {/for}
      </div>
      {/for}
    </div>
    <div class="score-container mt-4">
      <div class="score-line"></div>
      <div class="score">{game.score} <span class="unit">{#if game.score > 0}points{#else}point{/if}</span></div>
    </div>
    {/if}
  </div>
  <ul class="game-nav nav nav-pills flex-nowrap align-items-center order-lg-0">
      <li class="nav-item" hx-post="{uri:GameController.restart(game.id)}" hx-target="#content">
        <button class="nav-link">
        <i class="bi bi-arrow-clockwise"></i>
        <span class="d-none d-lg-block">Restart</span>
        </button>
      </li>
      <li class="nav-item flex-grow-1">
        <h3>{game.name}</h3>
      </li>
      <li class="nav-item" hx-get="{uri:BoardController.leaderboard(game.boardId)}" hx-push-url="true" hx-target="#content">
        <button class="nav-link">
        <i class="bi bi-trophy"></i>
        <span class="d-none d-lg-block">Leaderboard</span>
        </button>
      </li>
    </ul>
</div>
{#else}
  <div class="alert alert-warning" role="alert">
    Game not found
  </div>
{/if}
{/fragment}
